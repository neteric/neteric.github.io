## full text search 从入门到放弃-原理篇

### 正向索引为什么不适合做全文索引？
   通常我们面对的数据可以分为结构化数据，半结构化数据库，非结构化数据，非结构化数据又有一直叫法叫全文数据

   结构化数据是指关系型数据库所擅长处理的那种带sheme的二维表数据
   半结构数据库是指类似xml,json这样数据模型
   而非结构化数据是指像word文档，邮件这样的文本数据亦或是音频,视频,图片这样的blob数据

   结构化和半结构化数据的索引通常是将数据行(row/document)里面的一些具有标识性的字段提取出来，组成树，hash table，跳表这样的索引结构来进行加速查询和检索，这种索引结构叫**正向索引**，而非结构化数据显然不能这样做，首要原因是非结构化数据按照关键字进行sheme化几乎不可能，其次如果把文档内容整体放到关系型数据库的一个字段中，数据的查询效率非常的低并且功能性也很弱。比如在MySQL中存在如下一张表，用SQL语句查询 select * from phone where describe like "%Huawei手机%" 会有什么问题呢？
   |id|describe|
   |:----:|:----:|
   |1|5G拍照清晰Huawei新款手机|
   |2|Iphone 4G旗舰手机|

   我们知道在查询语句中用了like关键字索引就会失效，如果表中有上万条记录，那么这条sql会进行全表扫描，也就是该表所有内容都需要从硬盘读入到buffer pool中进行对比，性能自然非常差。其次id=1的这条记录应该被用户查询到，但该SQL却查询不出来,就算变通一下SQL的写法也很难匹配到其他满足条件的记录。

### 非结构化数据应该怎么建立索引来实现快速查询？

   **顺序扫描(Serial Scanning)**

   当数据规模不大，直接用最简单也最高效的顺序扫描即可，linux上的grep其实就是这样的工作方式，但当数据规模大了过后，顺序扫描几乎为不可用，设想一下从10000个大小为10G的文件中用grep查找包含关键字”程序员“的记录。。。
   
   **倒排索引**

首先我们来看为什么顺序扫描的速度慢：其实是由于我们想要搜索的信息和非结构化数据组织的方式不一致造成的。
非结构化数据中所存储的信息是每个文件包含哪些字符串，是从文件到字符串的映射，即已知文件，欲求字符串相对容易。而我们想搜索的信息是哪些文件包含此字符串，也即已知字符串，欲求文件，也即是需要从字符串到文件的映射。两者恰恰相反。因此如果索引总能够保存从字符串到文件的映射，则会大大提高查询速度。由于从字符串到文件的映射是文件到字符串映射的反向过程，于是保存这种信息的索引称为反向索引也叫倒排索引








